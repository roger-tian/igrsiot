<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.igrs.igrsiot.dao.IIgrsDeviceStatusDao" >
  <resultMap id="BaseResultMap" type="com.igrs.igrsiot.model.IgrsDeviceStatus" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="device" property="device" jdbcType="BIGINT" />
    <result column="attribute" property="attribute" jdbcType="VARCHAR" />
    <result column="value" property="value" jdbcType="VARCHAR" />
  </resultMap>

  <sql id="Base_Column_List" >
    id, device, attribute, value
  </sql>

  <select id="getStatusByRoom" resultMap="BaseResultMap" parameterType="String" >
    select * from igrs_device_status where device in (select id from igrs_device where room=#{room})
  </select>

  <select id="getByDeviceAndAttr" resultMap="BaseResultMap" parameterType="com.igrs.igrsiot.model.IgrsDeviceStatus" >
    select * from igrs_device_status where device=#{device} and attribute=#{attribute}
  </select>

  <select id="getByRoomChAttr" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select * from igrs_device d, igrs_device_status s
    where d.id=s.device and d.room=#{room} and d.cchannel=#{channel} and s.attribute=#{attribute}
  </select>

  <update id="updateByDeviceAndAttr" parameterType="com.igrs.igrsiot.model.IgrsDeviceStatus" >
    update igrs_device_status set value=#{value} where device=#{device} and attribute=#{attribute}
  </update>

  <update id="updateByRoomChAttr" parameterType="java.util.Map" >
    update igrs_device d, igrs_device_status s set s.value=#{value}
    where d.id=s.device and d.room=#{room} and d.cchannel=#{channel} and s.attribute=#{attribute}
  </update>

  <insert id="insert" parameterType="com.igrs.igrsiot.model.IgrsDeviceStatus" >
    insert into igrs_device_status(device,attribute,value) values(#{device}, #{attribute}, #{value})
  </insert>

  <insert id="insertByRoomChAndAttr" parameterType="java.util.Map" >
    insert into igrs_device_status(device,attribute,value)
    values((select d.id from igrs_device d where d.room=#{room} and d.cchannel=#{channel}), #{attribute}, #{value})
  </insert>
</mapper>